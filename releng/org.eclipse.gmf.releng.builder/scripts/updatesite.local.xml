<project basedir=".">

	<import file="build-common.xml"/>

	<target name="init">		
		<tstamp/>
		<property name="date" value="${DSTAMP}" />
		<property name="time" value="${TSTAMP}" />
		<property name="timestamp" value="${date}${time}" />
		<property name="buildType" value="C" />	
		<property name="buildId" value="${buildType}${date}" />
		<!--this naming convention used by php scripts on download server-->
		<property name="buildLabel" value="${buildType}-${buildId}-${timestamp}" />
		<condition property="skipUpload">
			<or>
				<not>
					<isset property="ftpUser"/>
				</not>	
				<not>
					<isset property="ftpPassword"/>
				</not>	
			</or>
		</condition>
	</target>	

	<target name="rsync.down" depends="init" if="updatesite.name">
		<exec executable="rsync">
			<arg value="-var"/>
			<arg value="--delete"/>
			<arg value="${ftpUser}@download1.eclipse.org:/home/www/modeling/gmf/update-site/${updatesite.name}"/>
			<arg value="${updatesite.local.path}/"/>
		</exec>	
	</target>
	
	<target name="rsync.up" depends="init" if="updatesite.name" unless="skipUpload">
		<exec executable="rsync">
			<arg value="-var"/>
			<arg value="--delete"/>
			<arg value="${updatesite.local.path}/${updatesite.name}"/>
			<arg value="${ftpUser}@download1.eclipse.org:/home/www/modeling/gmf/update-site/"/>
		</exec>	
	</target>	
	
	<target name="init.site" depends="init" if="updatesite.name">
		<mkdir dir="${updatesite.local.path}"/>
		<delete dir="${updatesite.local.path}/${updatesite.name}" failonerror="false"/>
		<copy todir="${updatesite.local.path}/${updatesite.name}">
			<fileset dir="${basedir}/updatesiteDropFiles"/>
		</copy>
	</target>
	
	<target name="mirror">
		<ant antfile="${scripts}/update.xml" target="mirror">
			<property name="to.updatesite" value="${updatesite.local.path}/${updatesite.name}"/>
		</ant>	
	</target>
	
</project>
