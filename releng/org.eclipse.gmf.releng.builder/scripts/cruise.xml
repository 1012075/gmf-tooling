<?xml version="1.0"?>
<project default="cruise">
	<property file="build.properties" />
	
	<!-- Commonly used directories -->
	<property name="reportdir" value="${cc.home}/reporting" />
	<property name="checkout" value="${buildRoot}/checkout" />
	<property name="logs" value="${buildRoot}/logs" />
	<property name="artifacts" value="${buildRoot}/artifacts" />
	
	<target name="init">
		<delete file="${basedir}/cc.properties" failonerror="false"/>
		<!-- Store the build properties in a file for CruiseControl to pick up. -->
		<echo file="${basedir}/cc.properties" append="true" >
		buildRoot=${buildRoot}
		</echo>
		<echo file="${basedir}/cc.properties" append="true" >
			cc.home=${cc.home}
		</echo>
		<echo file="${basedir}/cc.properties" append="true" >
			buildmaster.email=${buildmaster.email}
		</echo>
		<echo file="${basedir}/cc.properties" append="true" >
			reportdir=${reportdir}
		</echo>
		<echo file="${basedir}/cc.properties" append="true" >
			checkout=${checkout}
		</echo>
		<echo file="${basedir}/cc.properties" append="true" >
			logs=${logs}
		</echo>
		<echo file="${basedir}/cc.properties" append="true" >
			artifacts=${artifacts}
		</echo>
		<mkdir dir="${logs}/checkout"/>
		<mkdir dir="${logs}/sdk"/>
		<mkdir dir="${logs}/runtime"/>
		<mkdir dir="${logs}/tests"/>
		<mkdir dir="${logs}/examples"/>
		<mkdir dir="${logs}/doc"/>
		<mkdir dir="${artifacts}/checkout"/>
		<mkdir dir="${artifacts}/sdk"/>
		<mkdir dir="${artifacts}/runtime"/>
		<mkdir dir="${artifacts}/tests"/>
		<mkdir dir="${artifacts}/examples"/>
		<mkdir dir="${artifacts}/doc"/>
		<available file="${buildRoot}/checkout/org.eclipse.gmf/features/org.eclipse.gmf.sdk-feature/build.properties" property="skipCheckout" />
		<antcall target="checkout"/>
	</target>
	
	<target name="cruise" depends="init">
		<java classname="CruiseControl" maxmemory="1024m" fork="true" failonerror="true">
			<arg value="-Djavax.management.builder.initial=mx4j.server.MX4JMBeanServerBuilder" />
			<classpath>
				<fileset dir="${cc.home}/main/lib">
		        	<include name="**/*.jar"/>
		      	</fileset>
				<fileset dir="${cc.home}/main/dist">
		        	<include name="**/*.jar"/>
		      	</fileset>
			</classpath>
		</java>
	</target>
	
	<target name="checkout" unless="skipCheckout">
		<ant antfile="${basedir}/checkout.xml" target="all"/>
	</target>

</project>