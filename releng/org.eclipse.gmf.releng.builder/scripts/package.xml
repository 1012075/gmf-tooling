<project name="Run update site optimization steps">
	
	<target name="pack200" if="pack200">
		<property name="packtmp" value="${buildDirectory}/packtmp" />
		<mkdir dir="${packtmp}" />	
		<move file="${buildDirectory}/${buildLabel}/${archiveName}" tofile="${packtmp}/${archiveName}"/>
		
	     <java jar="${equinox.launcher.jar}"
	           fork="true"
        	   jvm="${java15-home}/bin/java"
	           failonerror="true"
	           maxmemory="128m"
			   dir="${buildDirectory}">
	         <arg line="-application org.eclipse.update.core.siteOptimizer"/>
	         <arg line="-jarProcessor -processAll -outputDir ${buildLabel} -pack -repack ${packtmp}/${archiveName}"/>
	       </java>
	
		<delete dir="${packtmp}" />
	</target>
	
	<target name="unpackUpdateJarsAndRepack">
		<property name="tmpsite" value="${buildDirectory}/tmpsite" />
		<mkdir dir="${tmpsite}/new/eclipse/features" />
		<mkdir dir="${tmpsite}/new/eclipse/plugins" />
		<exec executable="unzip" dir="${buildDirectory}/${buildLabel}">
			<arg line="-q ${archiveName} -d ${tmpsite}" />
		</exec>
		<unpackUpdateJars site="${tmpsite}/eclipse" output="${tmpsite}/new/eclipse"/>
		<!-- copy root files -->
		<copy todir="${tmpsite}/new/eclipse">
			<fileset dir="${tmpsite}/eclipse">
				<include name="*"/>
			</fileset>
		</copy>
		<zip destfile="${buildDirectory}/${buildLabel}/${archiveName}"
			basedir="${tmpsite}/new"
	  	/>
		<delete dir="${tmpsite}"/>
	</target>
</project>
