@Ecore(settingDelegates="org.msl.simple.gmfmap.simplemapping.setting", invocationDelegates="org.msl.simple.gmfmap.simplemapping.invocation")
@namespace(uri="http://org.msl.simple.gmfmap/simplemappings_1.1", prefix="simplemap")
package simplemappings;

import "platform:/plugin/org.eclipse.gmf.map/models/gmfmap.ecore";
import "platform:/plugin/org.eclipse.gmf.graphdef/models/gmfgraph.ecore";
import "platform:/plugin/org.eclipse.gmf.tooldef/models/tooldef.ecore";

class SimpleMapping extends SimpleParentNode {
  ref gmfgraph.Canvas canvas;
  ref tooldef.Palette palette;
  ref mappings.Mapping mapping;

  @org.msl.simple.gmfmap.simplemapping.setting
  ref ecore.EPackage domainModel;

  @org.msl.simple.gmfmap.simplemapping.setting
  ref EClass domainMetaElement;
}

class SimpleTopNode extends SimpleNode, SimpleParentNode {
  val SimpleLinkMapping[*] links;
}

class SimpleCompartment extends SimpleParentNode, SimpleChildNode, SimpleMappingElementWithFigure {
  derived ref mappings.CompartmentMapping compartmentMapping;

  @org.msl.simple.gmfmap.simplemapping.setting
  attr String name;

  @org.msl.simple.gmfmap.simplemapping.setting
  readonly unsettable derived ref gmfgraph.Compartment compartment;

  @org.msl.simple.gmfmap.simplemapping.setting
  readonly unsettable derived ref gmfgraph.Label compartmentLabel;
  attr boolean needsTitle = true;
}

class SimpleLabelNode extends SimpleNode {
}

class SimpleLinkMapping extends SimpleChildNode, SimpleParentNode, SimpleMappingElementWithFigure {
  attr String name;
  derived ref mappings.LinkMapping linkMapping;

  @org.msl.simple.gmfmap.simplemapping.setting
  ref gmfgraph.Connection diagramLink;

  @org.msl.simple.gmfmap.simplemapping.setting
  readonly unsettable derived ref gmfgraph.DiagramLabel diagramLabel;

  @org.msl.simple.gmfmap.simplemapping.setting
  readonly unsettable derived ref tooldef.AbstractTool tool;
}

class SimpleNode extends SimpleChildNode, SimpleMappingElementWithFigure, SimpleNodeReference {

  @org.msl.simple.gmfmap.simplemapping.setting
  readonly unsettable derived ref tooldef.AbstractTool tool;

  @org.msl.simple.gmfmap.simplemapping.setting
  transient ref ecore.EAttribute[*] labelAttributes;

  @org.msl.simple.gmfmap.simplemapping.setting
  readonly unsettable derived ref gmfgraph.Node diagramNode;

  @org.msl.simple.gmfmap.simplemapping.setting
  readonly unsettable derived ref gmfgraph.DiagramLabel diagramLabel;

  @org.msl.simple.gmfmap.simplemapping.setting
  transient derived ref EClass domainMetaElement;
}

abstract interface SimpleParentNode {
  val SimpleChildNode[*]#parentNode children;
}

abstract interface SimpleChildNode {
  unsettable ref SimpleParentNode#children parentNode;

  @org.msl.simple.gmfmap.simplemapping.setting
  transient ref SimpleMapping parentMapping;

  @org.msl.simple.gmfmap.simplemapping.setting
  ref SimpleNode parent;

  @org.msl.simple.gmfmap.simplemapping.setting
  transient ref EClass parentMetaElement;
}

class SimpleSubNode extends SimpleNode, SimpleParentNode {
}

class SimpleMappingElementWithFigure {

  @org.msl.simple.gmfmap.simplemapping.setting
  ref gmfgraph.Figure nodeFigure;

  @org.msl.simple.gmfmap.simplemapping.setting
  ref gmfgraph.Figure labelFigure;
}

class SimpleChildReference extends SimpleNodeReference, SimpleChildNode {

  @org.msl.simple.gmfmap.simplemapping.setting
  transient derived ref mappings.NodeMapping referencedChild;
  ref SimpleNode referencedSimpleNode;
}

class SimpleNodeReference {
  derived ref mappings.NodeReference nodeReference;

  @org.msl.simple.gmfmap.simplemapping.setting
  transient derived ref ecore.EReference containmentFeature;

  @org.msl.simple.gmfmap.simplemapping.setting
  attr String name;
}

